@inject HttpClient Http
@inject NavigationManager NavigationManager
@inject SweetAlertService Swal
<!-- ======= Contact Section ======= -->
<section id="contact" class="contact" style="background: rgb(34,195,158);
background: linear-gradient(225deg, rgba(34,195,158,1) 0%, rgba(87,102,130,1) 100%);border-radius:5px">
    <div class="container">
        <div class="row">
            <div class="col-lg-12" data-aos="fade-up" data-aos-delay="100">
                <EditForm Model="NuevaCinta">
                    <form class="php-email-form mt-4">
                        <div class="form-group mt-3">
                            <b style="color:beige">Nombre de la Cinta</b>
                            <input type="text" class="form-control" @bind-value=NuevaCinta.Nombre name="subject" id="subject" placeholder="Nombre" required>
                        </div>
                        <div class="form-group mt-3">
                            <b style="color:beige">Descripcion</b>
                            <InputSelect @bind-Value="NuevaCinta.Descripcion" class="form-control" placeholder="Capacidad">
                                <option value="-1">Elegir Tipo Fluido</option>
                                @foreach (var i in Descripciones)
                                {
                                    <option value="@i">@i</option>
                                }
                            </InputSelect>
                        </div>
                        <div class="my-3">
                            <div class="sent-message"><b style="color:beige">Recuerde configurar los rangos de la cinta</b> </div>
                        </div>
                    </form>
                    <div class="text-center"><button class="btn btn-primary" @onclick=GuardarCinta data-bs-dismiss="modal" aria-label="Close">Guardar</button></div>
                    <br />
                </EditForm>
            </div>
        </div>

    </div>
</section><!-- End Contact Section -->
@code {
    [Parameter]  
    public Cinta? NuevaCinta { get; set; }
    [Parameter]
    public int? Edita { get; set; }//Si es 1 edita si es 0 Crea uno nuevo
                                   //Lita de Tipo de fluido
    public static List<string> Descripciones = new List<string>
        {
            {"Crudo"},{"Refinado"}
    };
    async Task GuardarCinta()
    {
        if (Edita == 0)
        {
            var resultado = await Swal.FireAsync(new SweetAlertOptions
                {
                    Title = "Guardar",
                    Text = "¿ Estas seguro que deseas guardar ?",
                    Icon = SweetAlertIcon.Info,
                    ShowCancelButton = true,
                    ConfirmButtonText = "Guardar",
                    CancelButtonText = "Cancelar"
                });

            var confirmado = !string.IsNullOrEmpty(resultado.Value);

            if (confirmado)
            {
                var respuesta = await Http.PostAsJsonAsync("api/Cinta", NuevaCinta);

                var exito = await Swal.FireAsync(new SweetAlertOptions
                    {
                        Position = "center",
                        Title = "Guardado Correctamente",
                        Icon = SweetAlertIcon.Success,
                        ShowCancelButton = false,
                        Timer = 1500
                    });
            }
        }
        else
        {
            var resultado = await Swal.FireAsync(new SweetAlertOptions
                {
                    Title = "Guardar",
                    Text = "¿ Estas seguro de guardar cambios ?",
                    Icon = SweetAlertIcon.Info,
                    ShowCancelButton = true,
                    ConfirmButtonText = "Guardar",
                    CancelButtonText = "Cancelar"
                });

            var confirmado = !string.IsNullOrEmpty(resultado.Value);

            if (confirmado)
            {
                var respuesta = await Http.PutAsJsonAsync($"api/Cinta{NuevaCinta.Id}", NuevaCinta);

                var exito = await Swal.FireAsync(new SweetAlertOptions
                    {
                        Position = "center",
                        Title = "Guardado Correctamente",
                        Icon = SweetAlertIcon.Success,
                        ShowCancelButton = false,
                        Timer = 1500
                    });
            }
        }

    }    
}
